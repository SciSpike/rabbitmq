###
# Generated by Chef
###

<% if node['rabbitmq']['ssl'] -%>
export ERL_SSL_PATH=$(erl -eval 'io:fwrite([code:lib_dir(ssl, ebin)]),halt().' -noshell)
export RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS=-pa ${ERL_SSL_PATH} \
-proto_dist inet_tls \
-ssl_dist_opt server_certfile <%= node['rabbitmq']['ssl_dist_cert']%> \
-ssl_dist_opt server_secure_renegotiate true client_secure_renegotiate true
<% end -%>

<% if node['rabbitmq']['local_erl_networking'] -%>
NODENAME=rabbit@localhost
NODE_IP_ADDRESS=127.0.0.1
export ERL_EPMD_ADDRESS=127.0.0.1
<% elsif node['rabbitmq']['erl_networking_bind_address'] -%>
NODENAME=<%= node['rabbitmq']['nodename'] %>
NODE_IP_ADDRESS=<%= node['rabbitmq']['erl_networking_bind_address'] %>
export ERL_EPMD_ADDRESS=<%= node['rabbitmq']['erl_networking_bind_address'] %>
<% else -%>
<% if node['rabbitmq']['address'] -%>NODE_IP_ADDRESS=<%= node['rabbitmq']['address'] %><% end %>
<% if node['rabbitmq']['nodename'] -%>NODENAME=<%= node['rabbitmq']['nodename'] %><% end %>
<% end -%>
<% if node['rabbitmq']['port'] -%>NODE_PORT=<%= node['rabbitmq']['port'] %><% end %>
<% if node['rabbitmq']['config'] -%>CONFIG_FILE=<%= node['rabbitmq']['config'] %><% end %>
<% if node['rabbitmq']['logdir'] -%>LOG_BASE=<%= node['rabbitmq']['logdir'] %><% end %>
<% if node['rabbitmq']['mnesiadir'] -%>MNESIA_BASE=<%= node['rabbitmq']['mnesiadir'] %><% end %>
<% if node['rabbitmq']['open_file_limit'] -%>ulimit -n <%= node['rabbitmq']['open_file_limit'] %><% end %>
<% if node['rabbitmq']['server_additional_erl_args'] -%>SERVER_ADDITIONAL_ERL_ARGS='<%= node['rabbitmq']['server_additional_erl_args'] %>'<% end %>
<% if node['rabbitmq']['ctl_erl_args'] -%>CTL_ERL_ARGS='<%= node['rabbitmq']['ctl_erl_args'] %>'<% end %>
